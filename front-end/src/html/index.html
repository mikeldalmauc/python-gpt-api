<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=no">

  <link rel="icon" href="assets/favicon.svg">

  <meta property="og:title" content="Character GPT chat">
  <meta name="description" content="Character GPT chat testing webpage">
  <meta property="og:type" content="website">

  <!-- TODO cambiar miniatura al final del proy  Â¿En que contexto sirve ver la steve?-->
  <meta property="og:image" content="assets/miniaturaPH.jpg">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <meta property="og:site_name" content="https://ec2-35-181-229-140.eu-west-3.compute.amazonaws.com">
  <meta property="og:url" content="https://ec2-35-181-229-140.eu-west-3.compute.amazonaws.com">
  <meta itemprop="name" content="Character GPT chat">
  <meta itemprop="description" content="Character GPT chat testing webpage">
  <meta name="author" content="Mikel Dalmau">

  <script src="main.js"></script>
  <!-- <script src="main.min.js"></script> -->
  <title>Mikel Dalmau</title>

  <style>

  </style>
</head>

<body>

  <div id="app"></div>
  <script>

    class TokenStorage {
      constructor(key) {
        this.key = key;
      }

      getToken() {
        return localStorage.getItem(this.key);
      }

      setToken(token) {
        localStorage.setItem(this.key, token);
      }

      deleteToken() {
        localStorage.removeItem(this.key);
      }
    }

    const tokenStorage = new TokenStorage("elm-character-gpt-token");
    const maybeToken = tokenStorage.getToken();

    var app = Elm.Main.init({
      node: document.getElementById('app'),
      flags: {
        width: window.innerWidth,
        height: window.innerHeight,
        //apiUrl: "https://ec2-35-181-229-140.eu-west-3.compute.amazonaws.com/api",
        apiUrl: "http://localhost:5000",
        maybeToken
      }
    });

    app.ports.send.subscribe(message => {
      console.info("send", message);
      switch (message?.tag) {
        case "deleteToken":
          tokenStorage.deleteToken();
          break;

        case "saveToken":
          tokenStorage.setToken(message.value);
          break;

        case "logError":
          console.error(message.value);
          break;

        default:
          console.error("Received an unexpected message", message);
      }
    });

    // document.addEventListener("wheel", (ev) => {
    //   if (!ev.ctrlKey) {
    //     app.ports.onWheel.send(ev);
    //   }
    // });

    // window.addEventListener("orientationchange", function () {
    //   location.reload();
    // });

  </script>

</body>